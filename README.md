# CDNsite
## Django site for CDNNOW API
### Утилиты для работы с CDNNOW
**Получение статистики трафика через API.** Для получения статистики трафика (переданный объем трафика CDN) необходимо выбрать портал и период. 
Статистика собирается за указанный день, или за месяц, если день не указан

**Получение метрик трафика через API.** Для получения метрик трафика портала необходимо указать портал и период. 
Разбиение периода происходит автоматически в зависимости от его длительности с учетом максимально возможного разбиения в 1440 точек (ограничение API CDNNOW). Выводятся следующие графики:
- edge_cache_status_hit_ratio - доля успешного возврата контента из кеша CDN, по отношению ко всем запросам (эфективность работы CDN)
- edge_requests_count - количество запросов на сервера CDN, edge_status_4xx - из них количество запросов, завершаемых ошибками 4хх
- origin_requests_count - количество запросов на сервер Origin, origin_status_4xx - из них количество запросов, завершаемых ошибками 4хх
- Отношение edge_requests_count к origin_requests_count, и edge_status_4xx к origin_status_4xx

**Проверка загрузки изображений через CDN.** В поле Page URL требуется ввести URL тестируемой страницы портала Sputnik, в поле CDN on the page - домен CDN, используемый на тестируемой странице. 
Домен CDN можно получить, открыв исходный текст тестируемой страницы. Например, 
в ссылке на изображение https://`cdn1.img.sputniknews.com.tr`/img/07e7/01/0d/1065715712_0:0:1536:864_1920x0_80_0_0_a64c0583379bdf20f66e30fbbc5be8c1.jpg.webp выделен домен CDN.
Если поле New CDN оставить пустым, то проверка загрузки избражений происходит по домену CDN из тестируемой страницы. 
Если указать новый CDN домен в поле New CDN, то все ссылки из тестрируемой страницы, использующие старый CDN, будут проверены на новом домене
В результате выводятся ссылки на страницы с ошибкой 404 и процент ошибок

**Проверка кеширования контента в CDN.** Кеширование позволяет посетителям сайта быстрее получать его содержимое. 
Для того, чтобы это работало, содержимое кеша на всех серверах должно быть одинаковым. 
Проверка кеша на серверах CDNNOW позволяет выяснить актуальность содержимого кеша, связанного с URL.

Если в результате проверки окажется, что содержимое кеша на серверах CDNNOW различается, рекомендуется запустить очистку кеша содержимого URL, 
чтобы кеш мог быть снова заполнен актуальными данными. 
В поле Page URL требуется ввести URL тестируемой страницы портала Sputnik, в поле CDN on the page - домен CDN, используемый на тестируемой странице. 
Домен можно получить, открыв исходный текст тестируемой страницы. 
Например, в ссылке на изображение https://`cdn1.img.sputniknews.com.tr`/img/07e7/01/0d/1065715712_0:0:1536:864_1920x0_80_0_0_a64c0583379bdf20f66e30fbbc5be8c1.jpg.webp выделен домен CDN.

Количество одновременно проверяемых ссылок должно быть не более 10. Если количество ссылок из CDN на странице больше 10, ссылки выбираются случайным образом. 
При этом количество ссылок может быть меньше 10 (сервис CDNNOW удаляет продублированные ссылки).

Внимание: запускать новые задачи по проверке кеша можно не чаще, чем 1 раз в 5 минут!

**Анализ лог файла CDN.** Вывод агрегированных значений лог файла, получаемого в CDNNOW на странице проекта. Требуемые поля в лог файле: request_uri, http_user_agent, http_referer, status. 
Разделитель полей csv: ;. Загружать можно как csv файлы, так и zip.

**Сведения о DNS домена и HTTP заголовках.** В поле Domain требуется ввести адрес домена, например, sputniknews.com.tr в поле CDN - домен CDN, (если несколько - через запятую), 
например, cdn1.img.sputniknews.com.tr.

В результате выводятся сведения о домене и HTTP заголовки

**Очистка кеша CDN.** Маски очистки кеша:
- Если параметр пустой, то очищается весь кеш
- Можно указать одну маску /img/* Из кеша будут удалены все файлы, начинающиеся на /img/ (/img/one.jpg, /img/two.jpg).
- Можно указать несколько масок через запятую /img/*, /video/* Из кеша будут удалены все файлы, начинающиеся на /img/ и /video/
  (/img/one.jpg, /img/two.jpg, /video/one.mp4, /video/video.avi и т.п.).
- Если указать маску без *, то из кеша будет удалён только файл с url, строго совпадающий с маской. К примеру, masks=/img/my_super_image.jpg?id=8193737182253
  Из кеша будет удалён файл, url которого строго совпадает с /img/my_super_image.jpg?id=8193737182253.
